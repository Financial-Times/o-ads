<!DOCTYPE html>
<!--
Details about the ads in this test within DFP.

We will target it here:
http://ad.doubleclick.net/adj/test.5887.dev/master-companion-test;sz=468x60,728x90;pos=banlb;tile=1;ord=7175506623216709?

The master ad is:
Advertiser: 2389285, FT DFP Test 1 Account Order: 3903162, Ongoing Test Ad( 1 of 14 ): 219337529, Ongoing banlb master test

The companion ad is:
Advertiser: 2389285, FT DFP Test 1 Account Order: 3903162, Ongoing Test Ad( 2 of 14 ): 219337406, Ongoing newssubs companion test

-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <meta http-equiv="CACHE-CONTROL" content="NO-CACHE">
    <title>Test DFP Ad on a page - master / companion</title>
    <link rel="stylesheet" href="../css/qunit-1.10.0pre.css" type="text/css" media="screen">
    <link rel="stylesheet" href="../css/tests.css" type="text/css" media="screen">
    <script src="../lib/jquery/jquery-1.7.2.js"></script>
    <script src="../lib/jquery/jquery.cookie.js"></script>
    <script src="../lib/qunit/qunit-1.10.0pre.js"></script>
    <script src="../js/util/QUnitChainer.js"></script>
    <script src="../js/util/qunitMock.lib.js"></script>
    <script src="../js/util/test-helpers.html.js"></script>
    <script src="../js/util/page-helpers.html.js"></script>
    <script src="../lib/sinon/sinon-1.1.1.js"></script>
    <script src="../lib/sinon/sinon-ie-1.1.1.js"></script>

    <script type="text/javascript">
        /*members AYSC, ENV, FT_U, Properties, ads, attr, cookies, css, dfp_site,
            dfp_zone, env, eq, find, isLegacyAPI, length, match, request,
            requestNewssubs, timeIntervalTolerance, timeoutTolerance, useDFP, write,
            intro, banlb, banlbmaster, newssubs, newssubscompanion, tlbxrib, mktsdata,
            hlfmpu, hlfmpucompanion, doublet, doubletcompanion, refresh, initDFP,
            lib, writeScriptMock, FTQA, writeScript
        */

        var FT = FT || {};

        FT.env = {
           "dfp_site": "test.5887.dev",
           "dfp_zone": "master-companion-test",
           // Override timeout values to ensure the ad calls have time to come back
           // before the positions are collapsed. This is to ensure we can test the page successfully.
           "timeoutTolerance": 1500000,
           "timeIntervalTolerance": 3000000
        };

        // Mock the properties object so we are considered to be non-live
        FT.Properties = { 'ENV': "ci" };
        var CheckAds = ['intro', 'banlb', 'newssubs', 'tlbxrib', 'mktsdata', 'hlfmpu', 'doublet', 'oob', 'corppop', 'refresh'];
        var MockSubdir = true;
    </script>

    <script src="../js/ft/advertising.utils.js"></script>
    <script src="../js/ft/advertising.utils.cookie.js"></script>
    <script src="../js/ft/HTMLAds.js"></script>
    <script src="../js/ft/DartForPublishers.js"></script>
    <script src="../js/util/mock-ads.html.js"></script>

    <script type="text/javascript">

        // Clear the cookies which cause values to be inserted into the Ad calls.
        //initCookies();
        var Tests = {
           'intro': TestMockNoAd.intro,
           'banlb': TestMockAd.banlbmaster,
           'newssubs': TestMockAd.newssubscompanion,
           'tlbxrib': TestMockNoAd.tlbxrib,
           'mktsdata': TestMockNoAd.mktsdata,
           'hlfmpu': TestMockAd.hlfmpucompanion,
           'doublet': TestMockAd.doubletcompanion,
           'refresh': TestMockNoAd.refresh
        };

        var Plan = {};
        Plan.nextTestPlan =  'ad-on-a-page-cognitivematch.html';
        QUnitChainer.init(Plan);

        FT.ads.initDFP();

        //now we find what test mode we are in and either call DFP (Integration) or Mock the ad call (unit)
        var testMode = unitOrIntegrationMode(FT._ads.utils.cookies.FTQA);

        if (testMode === 'unit'){
          //
          var imgExps = {

          };
         //if unit test, then we override FT.lib.writeScript with the call to Mocking
         FT._ads.utils.writeScript = function (URL) {
             mockAdContent(URL, Tests); // Ads injected immediately
          };
        }

        // Clear the cookies which cause values to be inserted into the Ad calls.
        initCookies();

        test("environment", function ()
        {
           expect(4);

           ok(FT.env, "FT.env should be defined");
           ok(FT._ads.utils.cookies, "FT._ads.utils.cookies should be defined");
           ok(FT.env.useDFP, "FT.env.useDFP should be set to true");
           ok(!FT.env.isLegacyAPI, "legacy API should not be used");
        });

        test("banlb master", function ()
        {
           expect(5);
           var banlb = $("div#banlb.advertising");
           //equal(banlb.css("display"), "block", "banlb div should have display");

           var banlbLink = banlb.find("a");
           equal(banlbLink.length, 1, "banlb div should contain 'a' tags total");

           var banlbImg = banlbLink.find("img");

           testImageAd("banlb", 1);

           //equal(banlbImg.length, 1, "banlb div should contain 'img' tags total");
           //ok(banlbImg.attr("src").match(/3-banlb-master-728x90\.GIF$/i), "banlb img tag should have source 3-banlb-master-728x90.GIF");
        });

        test("newssubs companion", function ()
        {
           expect(6);
           var newssubs = $("div#newssubs.advertising");
           equal(newssubs.css("display"), "block", "newssubs div should have display");

           var newssubsLink = newssubs.find("a");
           equal(newssubsLink.length, 1, "newssubs div should contain 'a' tags total");

           var newssubsImg = newssubsLink.find("img");
           testImageAd("newssubs", 1);
        });

        test("doublet companion", function ()
        {
           expect(5);
           var doublet = $("div#doublet");
           equal(doublet.css("display"), "block", "doublet div should have display");

           var doubletLink = doublet.find("a");
           equal(doubletLink.length, 6, "doublet div should contain 'a' tags total");

           var doubletImg = doubletLink.find("img");
           equal(doubletImg.length, 2, "doublet div should contain 'img' tags total");

           ok(doubletImg.eq(0).attr("src").match(/doublet-companion-1-167x96\.jpg$/i), "doublet img tag should have source doublet-companion-1-167x96.jpg");
           ok(doubletImg.eq(1).attr("src").match(/doublet-companion-2-167x96\.jpg$/i), "doublet img tag should have source doublet-companion-2-167x96.jpg");
        });
    </script>
</head>

<body class="no-tlbxrib no-mktsdata no-refresh">
  <h1 id="qunit-header">DartForPublishers.js</h1>
  <h2 id="qunit-banner"></h2>
  <h2 id="qunit-userAgent"></h2>
  <h2 id="mode"></h2>

  <ol id="qunit-tests"></ol>

	<p>
		The purpose of this page is to see the Falcon FT.ads library working
		with Dart for Publishers using the deepEqual page structure that is in use
		on the Falcon home pages i.e. <a href="http://www.ft.com/home/uk">http://www.ft.com/home/uk</a>
	</p>
	<p>
		<b>This pages tests with targeting settings chosen to deliver a
			banlb master and newssubs companion ad.</b>
	</p>
	<p>The ads are booked under
	</p><ol>
		<li>Advertiser:<a title="Must use IE for this link" href="http://dfp.doubleclick.net/sso?useSso=true&amp;networkid=5887&amp;advertiserid=2389285">2389285</a><a>
					FT DFP Test 1 Account
		</a></li><a>
		</a><li><a>Order:</a><a title="Must use IE for this link" href="http://dfp.doubleclick.net/sso?useSso=true&amp;networkid=5887&amp;orderid=3903162">3903162</a><a>
					Ongoing Test
		</a></li><a>
		</a><li><a>Ad: Ongoing banlb master test ID: </a><a title="Must use IE for this link" href="http://dfp.doubleclick.net/sso?useSso=true&amp;networkid=5887&amp;&amp;adid=219337529">219337529</a>
			and others.</li>
	</ol>
	<p></p>
	<p>
		And are targeted to DFP site/zone<b>
        <script type="text/javascript">
            document.write(FT.env.dfp_site + '/' + FT.env.dfp_zone);
        </script>
		</b>
	</p>
	<p>
		See <a href="ad-on-a-page.html">ad-on-a-page.html</a> for using the
		Falcon API with targeted ads.
	</p>
	<p>
		See <a href="ad-on-a-page-legacy.html">ad-on-a-page-legacy.html</a>
		for using the Legacy Ads API with the Falcon library as for example on
		the blogs pages <a href="http://blogs.ft.com/dearlucy">http://blogs.ft.com/dearlucy</a>
	</p>

	<hr>
	<form>
		<input type="button" name="expand" value="expand" onclick="expandAll()" alt="show all Ad divs on the page"> <input type="button" name="diagnose" value="diagnose" onclick="showDiagnosis()" alt="display Ad diagnostics"> <input type="button" name="stop timer" value="stop timer" onclick="stopTimer()" alt="stop the interval timer">
	</form>
	<hr>


	<div id="main"></div>
	<!-- if in integration mode, make two calls to the adserver in order to correctly set the cookie for master / companion tracking -->
	<div id="dccookie" style="display: none">
		<script>unitOrIntegrationMessage(testMode);</script>
	</div>

	<hr>
	<p>From here down the page's div structure resembles the home page
		structure. Div's to hold the final ad location are just below.</p>
	<p>If no ads show, then there is something wrong with the code or
		with the ad targeting.</p>

	<div id="fullpage-container">Ad request fullpage-container</div>
	<script type="text/javascript">
        FT.ads.request('intro');
    </script>
	<div class="clearfix container">
		clearfix container
		<div class="master-column middleSection" data-zone="middleSection">
			master-column middleSection
			<div class="master-row topAds">
				master-row topAds
				<div id="banlb" class="advertising">
					Ad request banlb
					<script type="text/javascript">
                        FT.ads.request("banlb");
                    </script>
				</div>
				<div id="newssubs" class="advertising">
					Ad request newssubs
					<script>
            FT.ads.requestNewssubs();
          </script>
				</div>
			</div>
			<div class="master-row railSection" data-zone="railSection">
				master-row railSection
				<div id="tlbxrib" class="advertising" style="display: none; ">
					Ad request tlbxrib
					<script type="text/javascript">
                        FT.ads.request("tlbxrib");
                    </script>
				</div>
				<div class="freestyle">
					freestyle
					<div id="wsodHomePageModule" class="rightRailComponent">
						Ad request wsodHomePageModule
						<div id="wsodHomePageModuleContent">
							Ad request wsodHomePageModuleContent
							<div class="advertising" id="mktsdata" style="display: none; ">
								Ad request mktsdata
								<!--  <span class="advert" style="width: 75px; height: 25px; margin-top: -3px;"> - -->
								<script type="text/javascript">
                                    FT.ads.request("mktsdata");
                                </script>
								<!--   </span> - -->
							</div>
						</div>
					</div>
				</div>

				<div id="hlfmpu" class="advertising">
					Ad request hlfmpu
					<script type="text/javascript">
                        FT.ads.request("hlfmpu");
                    </script>
				</div>
				<div class="railComponent togglable maximised advertising">
					railComponent togglable maximised advertising <span class="toggleButton"> </span>
					<h3 class="">
						<span class="railComponentHeading"> Highlights </span>
					</h3>
					<div class="toggleContent">
						toggleContent
						<div id="doublet">
							Ad request doublet
							<script type="text/javascript">
                                FT.ads.request("doublet");
                            </script>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="adRequests">
			adRequests
			<div id="oob">
				Ad request oob
				<script type="text/javascript">
                    FT.ads.request('oob');
                </script>
			</div>
			<div id="corppop">
				Ad request corppop
				<script type="text/javascript">
                    FT.ads.request('corppop');
                </script>
			</div>
			<div id="refresh" class="advertising" style="display: none; ">
				Ad request refresh
				<script type="text/javascript">
                    FT.ads.request('refresh');
                </script>
			</div>
		</div>
	</div>

	<hr>
	<form>
		<input type="button" name="expand" value="expand" onclick="expandAll()" alt="show all Ad divs on the page"> <input type="button" name="diagnose" value="diagnose" onclick="showDiagnosis()" alt="display Ad diagnostics"> <input type="button" name="stop timer" value="stop timer" onclick="stopTimer()" alt="stop the interval timer">
	</form>
	<hr>

</body>
</html>

<!DOCTYPE html>

<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
    <title>Test Ad on a page - Locally served corporate access popup Cookie testing</title>
    <link rel="stylesheet" href="../css/qunit-1.10.0pre.css" type="text/css" media="screen">
    <link rel="stylesheet" href="../css/tests.css" type="text/css" media="screen" />
    <script src="../lib/jquery/jquery-1.7.2.js"></script>
    <script src="../lib/jquery/jquery.cookie.js"></script>
    <script src="../lib/qunit/qunit-1.10.0pre.js"></script>
    <script src="../js/util/QUnitChainer.js"></script>
    <script src="../js/util/qunitMock.lib.js"></script>
    <script src="../js/util/test-helpers.html.js"></script>
    <script src="../js/util/page-helpers.html.js"></script>
    <script src="../lib/sinon/sinon-1.1.1.js"></script>
    <script src="../lib/sinon/sinon-ie-1.1.1.js"></script>
    <style type="text/css">
        iframe {
            position: fixed;
            top: 0;
            right:0;
            background:#FFF;
        }
    </style>
<script>
/*members AYSC, ENV, FT_U, Properties, adName, ads, adverts, asset,
   banlb, cookies, corppop, description, dfp_site, dfp_zone, doublet, env,
   hlfmpu, intro, isLegacyAPI, length, mktsdata, newssubs, next, refresh,
   refreshTimer, regex, request, requestNewssubs, response,
   timeIntervalTolerance, timeoutTolerance, tlbxrib, useDFP, write,
   writeScript, writeScriptMock, FTQA, banlb2, newssubs2, initDFP, lib
*/
QUnit.config.autostart = false;

var FT = FT || {};
FT.env =
{
   "dfp_site": "test.5887.dev",
   "dfp_zone": "build-url-test",
   "asset":    "page",

   // Override timeout values to ensure the ad calls have time to come back
   // before the positions are collapsed. This is to ensure we can test the page successfully.
   "timeoutTolerance": 1500000,
   "timeIntervalTolerance": 3000000
};
// Mock the properties object so we are considered to be non-live
FT.Properties = { 'ENV': "ci" };
var CheckAds = ['intro', 'banlb', 'newssubs', 'tlbxrib', 'mktsdata', 'hlfmpu', 'doublet', 'oob', 'corppop', 'refresh'];
var cookieVariants = [
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "check"}, { "name": "AYSC", "value": "_22L0AAAAA_2712345_97_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "check"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_2712345_97_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_97_98PVT_97_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27PVT_97_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27RES_97_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27_97_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0P1Tools_2712345_97_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0P2Tools_2712345_97_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0P1P2Tools_2712345_97_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P1Tools_2712345_97_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P2Tools_2712345_97_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_2712345_97_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0Tools_2712345_97_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "check"}, { "name": "AYSC", "value": "_22L0AAAAA_2712345_97c_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "check"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_2712345_97c_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_97_98PVT_97c_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27PVT_97c_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27RES_97c_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27_97c_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0P1Tools_2712345_97c_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0P2Tools_2712345_97c_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0P1P2Tools_2712345_97c_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P1Tools_2712345_97c_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P2Tools_2712345_97c_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_2712345_97c_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0Tools_2712345_97c_98PVT" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "check"}, { "name": "AYSC", "value": "_22L0AAAAA_27dummyctid_97_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "check"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27dummyctid_97_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_97_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27PVT_97_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27RES_97_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27_97_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0P1Tools_27dummyctid_97_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0P2Tools_27dummyctid_97_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0P1P2Tools_27dummyctid_97_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P1Tools_27dummyctid_97_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P2Tools_27dummyctid_97_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_27dummyctid_97_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0Tools_27dummyctid_97_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "check"}, { "name": "AYSC", "value": "_22L0AAAAA_27dummyctid_97c_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "check"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27dummyctid_97c_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_97c_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27PVT_97c_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27RES_97c_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27_97c_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0P1Tools_27dummyctid_97c_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0P2Tools_27dummyctid_97c_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0P1P2Tools_27dummyctid_97c_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P1Tools_27dummyctid_97c_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P2Tools_27dummyctid_97c_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_2712345_97c_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0Tools_27dummyctid_97c_98IA" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "check"}, { "name": "AYSC", "value": "_22L0AAAAA_27dummyctid_97_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "check"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27dummyctid_97_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_97_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27PVT_97_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27RES_97_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27_97_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0P1Tools_27dummyctid_97_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0P2Tools_27dummyctid_97_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0P1P2Tools_27dummyctid_97_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P1Tools_27dummyctid_97_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P2Tools_27dummyctid_97_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_27dummyctid_97_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0Tools_27dummyctid_97_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "check"}, { "name": "AYSC", "value": "_22L0AAAAA_27dummyctid_97c_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "check"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27dummyctid_97c_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_97c_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27PVT_97c_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27RES_97c_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0AAAAA_27_97c_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0P1Tools_27dummyctid_97c_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0P2Tools_27dummyctid_97c_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0P1P2Tools_27dummyctid_97c_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P1Tools_27dummyctid_97c_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P2Tools_27dummyctid_97c_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_2712345_97c_98A" }],
     [{ "name" : "CorpPopTimeout", "value": "undef"}, { "name": "FT_AM", "value": "undef"}, { "name": "AYSC", "value": "_22P0Tools_27dummyctid_97c_98A" }]
];

</script>
    <script src="../js/ft/advertising.utils.js"></script>
    <script src="../js/ft/advertising.utils.cookie.js"></script>
    <script src="../js/ft/HTMLAds.js"></script>
    <script src="../js/ft/DartForPublishers.js"></script>
    <script src="../js/util/mock-ads.html.js"></script>
<script>

var Tests = {
   'intro': TestMockAd.intro,
   'banlb': TestMockAd.banlb3,
   'newssubs': TestMockAd.newssubs2,
   'tlbxrib': TestMockAd.tlbxrib,
   'mktsdata': TestMockAd.mktsdata,
   'hlfmpu': TestMockAd.hlfmpu,
   'doublet': TestMockAd.doublet,
   'refresh': TestMockAd.refresh
};

FT.ads.initDFP();
//now we find what test mode we are in and either call DFP (Integration) or Mock the ad call (unit)
testMode = unitOrIntegrationMode(FT._ads.utils.cookies.FTQA);


function multicookieAssertions() {
var m = FT._ads.utils.cookies.AYSC.match(/(_22)([^_]+)/);
    var val22 = '';

    if (m) {
       val22 = m[2];
    }

    var n = FT._ads.utils.cookies.AYSC.match(/(_27)([^_]+)/);
    var val27 = '';

    if (n) {
       val27 = n[2];
    }

    var o = FT._ads.utils.cookies.AYSC.match(/(_97)([^_]+)/);
    var val97 = '';

    if (o) {
       val97 = o[2];
    }

    var p = FT._ads.utils.cookies.AYSC.match(/(_98)([^_]+)/);
    var val98 = '';

    if (p) {
       val98 = p[2];
    }

    var number_ads_in_banlb = 3;
    var corppop_overlayResult = 1;
    var corpSignPopadResult = 1;
    var accmanwrapperResult = 0;

    //AYSC must be defined,  and field _27 must have a value, but not equal PVT or RES
    if ((typeof(FT._ads.utils.cookies.AYSC) === "undefined") || (!val27.match(/[0-9A-Za-z]/)) || (val27.match(/RES/)) || (val27.match(/PVT/))){
       number_ads_in_banlb = 2;
       corppop_overlayResult = 0;
       corpSignPopadResult = 0;
    }

    //should never get corp pops if cookieconsent value is not set
    else if (typeof FT._ads.utils.cookies.cookieconsent === "undefined" ){
        number_ads_in_banlb = 2;
        corppop_overlayResult = 0;
        corpSignPopadResult = 0;
    }

    //should never get corp pops if FT_AM cookie exists
    else if (typeof FT._ads.utils.cookies.FT_AM !== "undefined" ){
       number_ads_in_banlb = 2;
       corppop_overlayResult = 0;
       corpSignPopadResult = 0;
    }

    else if (val98 == '' || (val98.match(/PVT/))){

       //AYSC 22 can not be at at a certain level of access
       if ((val22.match(FT.ads.CONST.SubsLevelReplaceLookup.cor[22])) || (val22.match(FT.ads.CONST.SubsLevelReplaceLookup.lv1[22])) || (val22.match(FT.ads.CONST.SubsLevelReplaceLookup.lv2[22]))){
         number_ads_in_banlb = 2;
         corppop_overlayResult = 0;
         corpSignPopadResult = 0;
       }

    }

    //AM2 conditions
    //AYSC 98 cannot match 'IA', but can be A to serve a new AM2 ad BUT not if AYSC 97 === 'c'
    else if (!val27.match(/[0-9A-Za-z]/)){
       number_ads_in_banlb = 2;
       corppop_overlayResult = 0;
       corpSignPopadResult = 0;
    }
    else if ((val97 === 'c') &&  (val98 === 'A')){
        number_ads_in_banlb = 2;
        corppop_overlayResult = 0;
        corpSignPopadResult = 0;
    }
    else if (val98.match(/IA/)){
        number_ads_in_banlb = 2;
        corppop_overlayResult = 0;
        corpSignPopadResult = 0;
    }
    else if (val98 === 'A'){
        number_ads_in_banlb = 2;
        //corppop_overlayResult = 1;
        corpSignPopadResult = 0;
        accmanwrapperResult = 1;
    }

    if (testMode === 'unit'){
       //if unit test, then we override FT.lib.writeScript with the call to Mocking
       FT._ads.utils.writeScript = function (URL){
           mockAdContent(URL, Tests); // Ads injected immediately
        };
       //HTML Ad call for new Corppops: in unit test mode  we override the urlstem so we can serve the html locally
       FT.corppop.HTMLAdData.urlStem = '';
    }

    window.context = iframe.contentWindow;
    //expect(44);

    ok(context.FT.env, "FT.env should be defined");
    ok(context.FT._ads.utils.cookies, "FT._ads.utils.cookies should be defined");
    equal(context.FT._ads.utils.cookies.FT_U, undefined, "FT.cookies.FT_U should be ");
    ok(context.FT.env.useDFP, "FT.env.useDFP should be set to true");
    ok(!context.FT.env.isLegacyAPI, "legacy API should not be used");
    equal(context.$('#intro_overlay').length, 1, 'intro ad should be inserted into the DOM with count');
    ok(true, "banlb - occasionally fails due to receipt of collapsed banlb master for 728x90 despite also getting a valid image -- investigate");
    // testImageAd('banlb', number_ads_in_banlb);
    // //the decoupling of corppop from the adserver means that we will no longer be able to detect corpops via the adserver logic
    // //and therefore whether interstitial ads should be served or not.
    // //consequently interstitials AND corppops may appear, though the number of interstitials should never be more than 1
    // var numberInterstitials = context.$('#interstitial_overlay').length;
    // ok(numberInterstitials < 2, 'no more than one interstitial ad should not be present in DOM');

    // var totalPopAds = context.$('#popad').length;
    // var totalPopAdsinCorpClass = context.$('.corpSignPopad').length

    // testPopAds (totalPopAds,totalPopAdsinCorpClass);
    // equal(context.$('#corppop_overlay').length, corppop_overlayResult, 'div with #corppop #corppop_overlay should have count');
    // equal(context.$('.corpSignPopad').length, corpSignPopadResult, 'number of AM1 corp pop ads');
    // equal(context.$('#accmanwrapper').length, accmanwrapperResult, 'number of AM2 corp pop ads');
    // testImageAd('newssubs');
    // testImageAd('tlbxrib');
    // testImageAd('mktsdata');
    // // test that we're getting the correct template-configured mktsdata ad back:
    // equal(context.$('#mktsdata span.sponsor').length, 1, 'should have a span.sponsor with count');
    // testImageAd('hlfmpu');
    // equal(context.$('#doublet .doublet-wrapper.doublet_first').length, 1, 'doublet_first should occur with count');
    // equal(context.$('#doublet .doublet-wrapper.doublet_first').next('.doublet-wrapper.doublet_last').length, 1, 'doublet_last should be next with count');
    // testRefreshAd('refresh',undefined);
    // equal(context.FT.ads.adverts.refresh.response.adName, 'refresh adjustment 32767', 'refresh should correctly store obj value as');
    // equal(context.FT.ads.adverts.refresh.response.refreshTimer, 32767000, 'refresh should correctly store refreshTimer value as');
}

function runTests(cookieValues) {

}

$(function() {
    iframe = document.createElement('iframe');
    iteration = -1;

    initCookies(FT._ads.utils.cookie('FTQA'));
    var i, j, cookies, cookie, cookieValues,
        iframeSrc = location.href.split('/');

    iframe.src = '../images/multicookie-iframe.html';

    $(iframe).load(function() {
        if (iteration !== -1) {
            cookies = cookieVariants[iteration];
            while(cookie = cookies.pop()){
                FT._ads.utils.cookie(cookie.name, cookie.value, {path: '/', domain: '.ft.com'});
            }
            QUnit.start();
            multicookieAssertions();
            QUnit.stop();
        }
        iteration++;
        console.log(iteration);
    });

    for(i = 0, j = cookieVariants.length; i < j; i++){
        cookies = Array.prototype.slice.call(cookieVariants[i]);
        while(cookie = cookies.pop()){
            cookieValues += ' ' + cookie.name + ': ' + cookie.value;
        }

        asyncTest("Multicookie tests:" + cookieValues, function () {
            console.log("Multicookie tests:" + cookieValues);
            iframe.contentDocument.location.reload(true);
        });

        cookieValues = '';
    }
    document.body.appendChild(iframe);
});
</script>
</head>

<body>
	<h1 id="qunit-header">Test Ad on a page - Locally served corporate
		access popup</h1>
	<h2 id="qunit-banner"></h2>
	<h2 id="qunit-userAgent"></h2>
    <div id="mode"></div>
    <div id="dccookie">
        <script>unitOrIntegrationMessage(testMode);</script>
    </div>

	<p>
		The purpose of this page is to see the Falcon FT.ads library working
		with Dart for Publishers using the deepEqual page structure that is in use
		on the Falcon home pages i.e. <a href="http://www.ft.com/home/uk">http://www.ft.com/home/uk</a>
	</p>
	<p>
		<b>This page tests with targeting settings chosen to deliver ads
			and the corporate popup as an interstitial.</b>
	</p>
	<P>
		<b>The page has been modified to allow testing against variable
			cookie settings</b>
	</P>
	<p>The ads are booked under
	<ol>
		<li>Advertiser:<a title="Must use IE for this link"
			href='http://dfp.doubleclick.net/sso?useSso=true&networkid=5887&advertiserid=2389285'>2389285</a>
					FT DFP Test 1 Account </li>
		<li>Order:<a title="Must use IE for this link"
			href='http://dfp.doubleclick.net/sso?useSso=true&networkid=5887&orderid=3903162'>3903162</a>
					Ongoing Test </li>
		<li>Ad: Ongoing banlb 468x60 ID: <a
			title="Must use IE for this link"
			href='http://dfp.doubleclick.net/sso?useSso=true&networkid=5887&&adid=217726086'>217726086</a>
			and others.</li>
	</ol>
	</p>
	<p>
		And are targeted to DFP site/zone<b>
        <script>document.write(FT.env.dfp_site + '/' + FT.env.dfp_zone);</script>
		</b>
	</p>
	<hr>
	<B>FT_AM Cookie: <script>document.write( FT._ads.utils.cookies.FT_AM );</script>
	</B>
	<br>
	<B>AYSC Cookie: <script>document.write(FT._ads.utils.cookies.AYSC );</script>
	</B>
	<hr>
	<form>
		<input type='button' name='expand' value='expand'
			onclick='expandAll()' alt='show all Ad divs on the page'> <input
			type='button' name='diagnose' value='diagnose'
			onclick='showDiagnosis()' alt='display Ad diagnostics'> <input
			type='button' name='stop timer' value='stop timer'
			onclick='stopTimer()' alt='stop the interval timer'>
	</form>
	<hr>
	<div id="mode"></div>
	<ol id="qunit-tests">
		<li></li>
	</ol>
</body>
</html>

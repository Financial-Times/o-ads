<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Legacy Test DFP Ad on a page with legacy API</title>
    <link rel="stylesheet" href="../css/qunit-1.10.0pre.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/tests.css" type="text/css" media="screen" />
    <script src="../js/util/QUnitChainer.js"></script>
    <script src="../js/util/test-helpers.html.js"></script>
    <script src="../js/util/page-helpers.html.js"></script>
    <script src="../lib/jquery/jquery-1.7.2.js"></script>
    <script src="../lib/qunit/qunit-1.10.0pre.js"></script>
    <script src="../js/util/qunitMock.lib.js"></script>
    <script>

        /*globals AD_BANLB, AD_CORPPOP, AD_MPU, AD_NEWSSUBS, AD_OOB, Advert,
           jQuery, beginNewPage, clientAds, defaults, document, equal, expect,
           initTest, locateDiv, matches, ok, test, testBuildURL, testImageAd,
           testRefreshAd, testRichMediaAd, initCookies, AD_REFRESH,
           unitOrIntegrationMessage, unitOrIntegrationMode, TestMockNoAd, TestMockAd,
           mockAdContent, MockSubdir
        */

        /*members AYSC, CONST, DefaultAdTag, ENV, FT_U, Properties, adName, ads,
           adverts, asset, attr, banlb, beginNewPage, buildURL, cookies, corppop,
           css, description, dfp_site, dfp_zone, doublet, env, fetch, find,
           getElementById, getLongestUrl, hasCalledInitDFP, hashCookies, mpu, init,
           initDFP, injectUrlTrackCall, isLegacyAPI, length, lib, mktsdata, name,
           newssubs, next, nextAll, oob, pos, refresh, refreshTimer, regex, render,
           response, slice, src, timeIntervalTolerance, timeoutTolerance, tlbxrib,
           trackUrl, type, urlThreshold, urlThresholdMax, useDFP, write, writeScript,
           writeScriptMock, FTQA, banlb3, newssubs2, corppop2
        */

        var FT = FT || {};
        FT.env =
        {
           "dfp_site": "test.5887.dev",
           "dfp_zone": "build-url-test",
           "asset":    "page",

           // Override timeout values to ensure the ad calls have time to come back
           // before the positions are collapsed. This is to ensure we can test the page successfully.
           "timeoutTolerance": 1500000,
           "timeIntervalTolerance": 3000000
        };
        // Mock the properties object so we are considered to be non-live
        FT.Properties = { 'ENV': "ci" };
        var CheckAds = ['banlb', 'newssubs', 'tlbxrib', 'mktsdata', 'mpu', 'doublet', 'oob', 'corppop', 'refresh'];
        var MockSubdir = false;
    </script>

    <script src="../js/ft/advertising.utils.js"></script>
    <script src="../js/ft/advertising.utils.cookie.js"></script>
    <script src="../js/ft/HTMLAds.js"></script>
    <script src="../js/ft/DartForPublishers.js"></script>
    <script src="../js/util/mock-ads.html.js"></script>
<script>
// Clear the cookies which cause values to be inserted into the Ad calls.
//initCookies();

var Tests = {
   'banlb': TestMockAd.banlb3,
   'newssubs': TestMockAd.newssubs2,
   'mpu': TestMockAd.mpu,
   'corppop': TestMockAd.corppop2,
   'refresh': TestMockAd.refresh
};

var Plan = {};
Plan.nextTestPlan =  'ad-on-a-page-legacy-noads.js.test.htm';
QUnitChainer.init(Plan);

var LegacyBoolean = 'yes';

FT.ads.initDFP();
//now we find what test mode we are in and either call DFP (Integration) or Mock the ad call (unit)
var testMode = unitOrIntegrationMode(FT._ads.utils.cookie("FTQA"));

if (testMode === 'unit') {
   //if unit test, then we override FT.lib.writeScript with the call to Mocking
   FT._ads.utils.writeScript = function (URL){
        mockAdContent(URL, Tests, LegacyBoolean); // Ads injected immediately
    };
    //HTML Ad call for new Corppops: in unit test mode  we override the urlstem so we can serve the html locally
   FT.corppop.HTMLAdData.urlStem = '';
}

test("Page Environment", function (){
   ok(FT.env,                                                                                      "FT.env should be defined");
   ok(FT.env.useDFP,                                                                               "FT.env.useDFP should be set to true");
   ok(FT.env.isLegacyAPI,                                                                          "Legacy API should be used");
});

test("banlb", function (){
   expect(5);
   ok(true,                                                                                        "occasionally fails due to receipt of collapsed banlb master for 728x90 despite also getting a valid image -- investigate");
   testImageAd('banlb', 2, 'ad-placeholder-');
});

test("interstitial off banlb", function (){
   expect(2);
   equal($('#interstitial_overlay').length, 1,                                               'interstitial ad should be inserted into the DOM with count');
   // the following check is in to check for interstitial corppop regression:
   equal($('#popad').length, 0,                                                              '#popad should not be present');
});

test("corppop off banlb", function () {
   expect(2);
   equal($('#corppop_overlay').length, 0,                                                    'div with #corpop_overlay should have count');
   equal($('.corppop_single_occurence').length, 0,                                           'there should no corp pop ad');
});

test("newssubs", function (){
   expect(4);
   testImageAd('newssubs', 1, 'ad-container-');
});

test("mpu", function () {
   expect(4);
   testImageAd('mpu', 1, 'ad-container-');
});

test("refresh", function() {
   expect(10);
   testRefreshAd('refresh', 'ad-container-');
   equal(FT.ads.adverts.refresh.response.adName, 'refresh adjustment 32767', 'refresh should correctly store obj value as');
   equal(FT.ads.adverts.refresh.response.refreshTimer, 32767000, 'refresh should correctly store refreshTimer value as');
});

      </script>
</head>

<body>
	<h1 id="qunit-header">Test DFP Ad on a page with legacy API</h1>
	<h2 id="qunit-banner"></h2>
	<h2 id="qunit-userAgent"></h2>
	<p>
		The purpose of this page is to see the Falcon FT.ads library working
		with Dart for Publishers using the deepEqual page structure that is in use
		on the Falcon blogs pages i.e. <a href="http://blogs.ft.com/dearlucy">http://blogs.ft.com/dearlucy</a>
	</p>
	<p>
		<b>This page tests with targeting settings chosen to deliver ads.</b>
	</p>
	<p>The ads are booked under
	<ol>
		<li>Advertiser:<a title="Must use IE for this link"
			href='http://dfp.doubleclick.net/sso?useSso=true&networkid=5887&advertiserid=2389285'>2389285</a>
					FT DFP Test 1 Account
		</li>
		<li>Order:<a title="Must use IE for this link"
			href='http://dfp.doubleclick.net/sso?useSso=true&networkid=5887&orderid=3903162'>3903162</a>
					Ongoing Test
		</li>
		<li>Ad: Ongoing banlb 468x60 ID: <a
			title="Must use IE for this link"
			href='http://dfp.doubleclick.net/sso?useSso=true&networkid=5887&&adid=217726086'>217726086</a>
			and others.</li>
	</ol>
	</p>
	<p>
		And are targeted to DFP site/zone<b> <script>
document.write(FT.env.dfp_site + '/' + FT.env.dfp_zone);
      </script>
		</b>
	</p>
	<p>
		See <a href="ad-on-a-page.html">ad-on-a-page.html</a> for using the
		Falcon API with targeted ads.
	</p>
	<p>
		See <a href="ad-on-a-page-noads.html">ad-on-a-page-noads.html</a> for
		using the Falcon API with no targeted ads to see div collapse.
	</p>
	<hr>
	<form>
		<input type='button' name='expand' value='expand'
			onclick='expandAll()' alt='show all Ad divs on the page'> <input
			type='button' name='diagnose' value='diagnose'
			onclick='showDiagnosis()' alt='display Ad diagnostics'> <input
			type='button' name='stop timer' value='stop timer'
			onclick='stopTimer()' alt='stop the interval timer'>
	</form>
	<hr>
	<div id="mode"></div>
	<ol id="qunit-tests">
		<li></li>
	</ol>

	<div id="main"></div>

	<!-- make two calls to the adserver in order to correctly set the cookie for master / companion tracking -->
	<div id="dccookie" style="display: none">
		<script>unitOrIntegrationMessage(testMode);</script>
	</div>

	<hr>
	<p>From here down the page's div structure resembles the blogs page
		structure. Div's to hold the final ad location are just below.</p>
	<p>If no ads show, then there is something wrong with the code or
		with the ad targeting.</p>

	<div id="head-content">
		head-content
		<div id="header-wrapper">
			header-wrapper
			<div id="leaderboard">
				leaderboard
				<div id="ad-placeholder-banlb"
					class="ad-placeholder ad-banlb leaderboard-advert">
					Ad ad-placeholder-banlb
					<script>

var banlb = new Advert(AD_BANLB);
banlb.init();

                  </script>
				</div>
				<div id="ad-container-newssubs"
					class="ad ad-container-newssubs ad-placeholder-newssubs ban-con-rgt leaderboard-newssubs">
					Ad ad-container-newssubs
					<script>

var newssubs = new Advert(AD_NEWSSUBS);
newssubs.init();

                  </script>
					<script>

clientAds.fetch(AD_NEWSSUBS);

                  </script>
				</div>
				<script>

clientAds.render(AD_NEWSSUBS);

               </script>

			</div>
			<div id="header" class="cf">
				header
				<div class="wrapper">
					wrapper
					<div class="masthead-wrapper cf">
						masthead-wrapper cf
						<div class="masthead">masthead</div>
						<div class="colright">
							colright
							<div class="cf" id="ft-search" style="width: 35.5em">
								ft-search
								<!--Assanka change: added namespacing div-->
								<div class="assankablogs">assankablogs</div>
								<div class="hideft">
									hideft
									<div style="display: none;" id="ontop" class="symbolSearch">ontop
									</div>
									<div class="menu">menu</div>
									<div class="altmenu">
										altmenu
										<div></div>
										<div></div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div id="navigation-wrapper">
			navigation-wrapper
			<div id="navigation">navigation</div>
			<div class="assankablogs">
				assankablogs
				<div class="alerts">alerts</div>
			</div>
			<div id="flexible-links" class="cf">flexible-links</div>
		</div>
	</div>
	<div id='ft-login-swizzy-popup' style='display: none'>ft-login-swizzy-popup
	</div>
	<div id="body-content">
		body-content
		<div id="body-wrapper">
			body-wrapper
			<div id="body-content-col">
				body-content-col
				<div id="primary-content">
					primary-content
					<div class="assankablogs">
						assankablogs
						<div class="backnforth top">
							backnforth top
							<div id="feedcontainer">feedcontainer</div>
							<div class="back">back</div>
						</div>
						<div id="content" class="narrowcolumn">
							narrowcolumn
							<div class='firstpost'>firstpost</div>
							<div class="post  " id="post-376">post-376</div>
							<div class="backnforth bottom">backnforth bottom</div>
						</div>
					</div>
				</div>
				<div id="secondary-content">secondary-content</div>
			</div>
			<div class="assankablogs">
				assankablogs
				<div id="rail-content">
					rail-content
					<div class="widgetcontent">
						widgetcontent
						<div class="wpuwidgetcontainer">
							wpuwidgetcontainer
							<div id="ad-container-mpu" class="ad ad-container-mpu">
								Ad ad-container-mpu
								<script>

var mpu = new Advert(AD_MPU);
mpu.init();

                           </script>
								<script>

clientAds.fetch(AD_MPU);

                           </script>
								<script>

clientAds.render(AD_MPU);

                           </script>
							</div>
						</div>
					</div>
					<div class="widgetcontent">widgetcontent</div>
				</div>
			</div>
			<div id="footer">
				footer
				<div id="footer-content">footer-content</div>
			</div>
			<div class="ad-calls">
				ad-calls
				<div id="ad-placeholder-oob" class="ad-placeholder ad-oob">
					Ad ad-placeholder-oob
					<script>

// Eventually enable this
var oob = new Advert(AD_OOB);
oob.init();

                  </script>
				</div>
				<div id="ad-placeholder-corppop" class="ad-placeholder ad-corppop">
					Ad ad-placeholder-corppop
					<script>
               //AYSC is undefined, so shouldnt get corppop
var adPop = new Advert(AD_CORPPOP);
adPop.init();

                  </script>
				</div>
				<div id="ad-container-macroad" class="ad ad-container-macroad">
					Ad request ad-container-macroad
					<script>

// clientAds.fetch(AD_MACROAD);

                  </script>
				</div>
				<script>
// clientAds.render(AD_MACROAD);
               </script>
				<div id="ad-container-marketingrib"
					class="ad ad-container-marketingrib">
					Ad request ad-container-marketingrib
					<script>
// clientAds.fetch(AD_MARKETINGRIB);
                  </script>
				</div>
				<script>
// clientAds.render(AD_MARKETINGRIB);
               </script>
				<div id="ad-container-tlbxrib" class="ad ad-container-tlbxrib">
					Ad request ad-container-tlbxrib
					<script>
// clientAds.fetch(AD_TLBXRIB);
                  </script>
				</div>
				<script>
// clientAds.render(AD_TLBXRIB);
               </script>
				<div id="ad-container-doublet" class="ad ad-container-doublet">
					Ad request ad-container-doublet
					<script>
// clientAds.fetch(AD_DOUBLET);
                  </script>
				</div>
				<script>
// clientAds.render(AD_DOUBLET);
               </script>
				<div id="ad-container-intro" class="ad ad-container-intro">
					Ad request ad-container-intro
					<script>
// clientAds.fetch(AD_INTRO);
                  </script>
				</div>
				<script>
// clientAds.render(AD_INTRO);
               </script>
				<div id="ad-container-hlfmpu" class="ad ad-container-hlfmpu">
					Ad request ad-container-hlfmpu
					<script>
// clientAds.fetch(AD_HLFMPU);
                  </script>
				</div>
				<script>
// clientAds.render(AD_HLFMPU);
               </script>
				<div id="ad-container-hmmpu" class="ad ad-container-hmmpu">
					Ad request ad-container-hmmpu
					<script>
// clientAds.fetch(AD_HMMPU);
                  </script>
				</div>
				<script>
// clientAds.render(AD_HMMPU);
               </script>
				<div id="ad-container-tradcent" class="ad ad-container-tradcent">
					Ad request ad-container-tradcent
					<script>
// clientAds.fetch(AD_TRADCENT);
                  </script>
				</div>
				<script>
// clientAds.render(AD_TRADCENT);
               </script>
				<div id="ad-container-marketing" class="ad ad-container-marketing">
					Ad request ad-container-marketing
					<script>
// clientAds.fetch(AD_MARKETING);
                  </script>
				</div>
				<script>
// clientAds.render(AD_MARKETING);
               </script>
				<div id="ad-container-banlb" class="ad ad-container-banlb">
					Ad request ad-container-banlb
					<script>
clientAds.fetch(AD_BANLB);
                  </script>
				</div>
				<script>
clientAds.render(AD_BANLB);
               </script>
				<div id="ad-container-mpusky" class="ad ad-container-mpusky">
					Ad request ad-container-mpusky
					<script>
// clientAds.fetch(AD_MPUSKY);
                  </script>
				</div>
				<script>
// clientAds.render(AD_MPUSKY);
               </script>
				<div id="ad-container-mpu" class="ad ad-container-mpu">
					Ad request ad-container-mpu
					<script>
clientAds.fetch(AD_MPU);
                  </script>
				</div>
				<script>
clientAds.render(AD_MPU);
               </script>
				<div id="ad-container-wdesky" class="ad ad-container-wdesky">
					Ad request ad-container-wdesky
					<script>
// clientAds.fetch(AD_WDESKY);
                  </script>
				</div>
				<script>
// clientAds.render(AD_WDESKY);
               </script>
				<div id="ad-container-nrwsky" class="ad ad-container-nrwsky">
					Ad request ad-container-nrwsky
					<script>
// clientAds.fetch(AD_NRWSKY);
                  </script>
				</div>
				<script>
// clientAds.render(AD_NRWSKY);
               </script>
				<div id="ad-container-artbox" class="ad ad-container-artbox">
					Ad request ad-container-artbox
					<script>
// clientAds.fetch(AD_ARTBOX);
                  </script>
				</div>
				<script>
// clientAds.render(AD_ARTBOX);
               </script>
				<div id="ad-container-fthbox" class="ad ad-container-fthbox">
					Ad request ad-container-fthbox
					<script>
// clientAds.fetch(AD_FTHBOX);
                  </script>
				</div>
				<script>
// clientAds.render(AD_FTHBOX);
               </script>
				<div id="ad-container-tlbx" class="ad ad-container-tlbx">
					Ad request ad-container-tlbx
					<script>
// clientAds.fetch(AD_TLBX);
                  </script>
				</div>
				<script>
// clientAds.render(AD_TLBX);
               </script>
				<div id="ad-container-fmbut2" class="ad ad-container-fmbut2">
					Ad request ad-container-fmbut2
					<script>
// clientAds.fetch(AD_FMBUT2);
                  </script>
				</div>
				<script>
// clientAds.render(AD_FMBUT2);
               </script>
				<div id="ad-container-lhn" class="ad ad-container-lhn">
					Ad request ad-container-lhn
					<script>
// clientAds.fetch(AD_LHN);
                  </script>
				</div>
				<script>
// clientAds.render(AD_LHN);
               </script>
				<div id="ad-container-mktbx" class="ad ad-container-mktbx">
					Ad request ad-container-mktbx
					<script>
// clientAds.fetch(AD_MKTBX);
                  </script>
				</div>
				<script>
// clientAds.render(AD_MKTBX);
               </script>
				<div id="ad-container-oob" class="ad ad-container-oob">
					Ad request ad-container-oob
					<script>
clientAds.fetch(AD_OOB);
                  </script>
				</div>
				<script>
clientAds.render(AD_OOB);
               </script>
				<div id="ad-container-pop" class="ad ad-container-pop">
					Ad request ad-container-pop
					<script>
// clientAds.fetch(AD_POP);
                  </script>
				</div>
				<script>
// clientAds.render(AD_POP);
               </script>
				<div id="ad-container-bxbar" class="ad ad-container-bxbar">
					Ad request ad-container-bxbar
					<script>
// clientAds.fetch(AD_BXBAR);
                  </script>
				</div>
				<script>
// clientAds.render(AD_BXBAR);
               </script>
				<div id="ad-container-dktalrt" class="ad ad-container-dktalrt">
					Ad request ad-container-dktalrt
					<script>
// clientAds.fetch(AD_DKTALRT);
                  </script>
				</div>
				<script>
// clientAds.render(AD_DKTALRT);
               </script>
				<div id="ad-container-dsktick" class="ad ad-container-dsktick">
					Ad request ad-container-dsktick
					<script>
// clientAds.fetch(AD_DSKTICK);
                  </script>
				</div>
				<script>
// clientAds.render(AD_DSKTICK);
               </script>
				<div id="ad-container-prnt" class="ad ad-container-prnt">
					Ad request ad-container-prnt
					<script>
// clientAds.fetch(AD_PRNT);
                  </script>
				</div>
				<script>
// clientAds.render(AD_PRNT);
               </script>
				<div id="ad-container-inv" class="ad ad-container-inv">
					Ad request ad-container-inv
					<script>
// clientAds.fetch(AD_INV);
                  </script>
				</div>
				<script>
// clientAds.render(AD_INV);
               </script>
				<div id="ad-container-mbatop" class="ad ad-container-mbatop">
					Ad request ad-container-mbatop
					<script>
// clientAds.fetch(AD_MBATOP);
                  </script>
				</div>
				<script>
// clientAds.render(AD_MBATOP);
               </script>
				<div id="ad-container-mbabot" class="ad ad-container-mbabot">
					Ad request ad-container-mbabot
					<script>
// clientAds.fetch(AD_MBABOT);
                  </script>
				</div>
				<script>
// clientAds.render(AD_MBABOT);
               </script>
				<div id="ad-container-mbalink" class="ad ad-container-mbalink">
					Ad request ad-container-mbalink
					<script>
// clientAds.fetch(AD_MBALINK);
                  </script>
				</div>
				<script>
// clientAds.render(AD_MBALINK);
               </script>
				<div id="ad-container-sbhead" class="ad ad-container-sbhead">
					Ad request ad-container-sbhead
					<script>
// clientAds.fetch(AD_SBHEAD);
                  </script>
				</div>
				<script>
// clientAds.render(AD_SBHEAD);
               </script>
				<div id="ad-container-ftnt" class="ad ad-container-ftnt">
					Ad request ad-container-ftnt
					<script>
// clientAds.fetch(AD_FTNT);
                  </script>
				</div>
				<script>

// clientAds.render(AD_FTNT);

               </script>
				<div id="ad-container-1x1" class="ad ad-container-1x1">
					Ad request ad-container-1x1
					<script>

// clientAds.fetch(AD_1x1);

                  </script>
				</div>
				<script>

// clientAds.render(AD_1x1);

               </script>
				<div id="ad-container-currcon" class="ad ad-container-currcon">
					Ad request ad-container-currcon
					<script>

// clientAds.fetch(AD_CURRCON);

                  </script>
				</div>
				<script>

// clientAds.render(AD_CURRCON);

               </script>
				<div id="ad-container-currbox" class="ad ad-container-currbox">
					Ad request ad-container-currbox
					<script>

// clientAds.fetch(AD_CURRBOX);

                  </script>
				</div>
				<script>

// clientAds.render(AD_CURRBOX);

               </script>
				<div id="ad-container-corppop" class="ad ad-container-corppop">
					Ad request ad-container-corppop
					<script>

// clientAds.fetch(AD_CORPPOP);

                  </script>
				</div>
				<script>

// clientAds.render(AD_CORPPOP);

               </script>
				<div id="ad-placeholder-refresh" class="ad ad-placeholder-refresh">
					Ad ad-placeholder-refresh
					<script>

var refresh = new Advert(AD_REFRESH);
refresh.init();

                  </script>
				</div>
				<div id="ad-container-refresh" class="ad ad-container-refresh">
					Ad request ad-container-refresh
					<script>

clientAds.fetch(AD_REFRESH);

                  </script>
				</div>
				<script>

clientAds.render(AD_REFRESH);

               </script>
				<script>

// Final rendering of ads
clientAds.render();

               </script>
			</div>
		</div>
	</div>
	<div id="fullpage-container">fullpage-container</div>

	<hr>
	<form>
		<input type='button' name='expand' value='expand'
			onclick='expandAll()' alt='show all Ad divs on the page'> <input
			type='button' name='diagnose' value='diagnose'
			onclick='showDiagnosis()' alt='display Ad diagnostics'> <input
			type='button' name='stop timer' value='stop timer'
			onclick='stopTimer()' alt='stop the interval timer'>
	</form>
	<hr>
	<script
		src="../js/util/test-helpers.html.js"></script>

</body>
</html>

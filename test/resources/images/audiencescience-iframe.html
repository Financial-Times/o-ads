<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<link rel="stylesheet" href="../css/tests.css" type="text/css" media="screen" />
<script src="../lib/jquery/jquery-1.7.2.js"></script>

<script>

    /*members AYSC, ENV, FT_U, Properties, adName, ads, adverts, asset,
     banlb, cookies, corppop, description, dfp_site, dfp_zone, doublet, env,
     hlfmpu, intro, isLegacyAPI, length, mktsdata, newssubs, next, refresh,
     refreshTimer, regex, request, requestNewssubs, response,
     timeIntervalTolerance, timeoutTolerance, tlbxrib, useDFP, write,
     writeScript, writeScriptMock, FTQA, banlb2, newssubs2, initDFP, lib
     */

    var FT = FT || {};
    //added for Track.js
    FT.$ = $;
    FT.env = FT.env || {};

    var j, debugStr = '',
            re = new RegExp("%3D"), testMode = "integration";

</script>

<script src="../js/ft/advertising.utils.js"></script>
<script src="../js/ft/advertising.utils.cookie.js"></script>
<script src="../js/ft/HTMLAds.js"></script>
<script src="../js/ft/DartForPublishers.js"></script>
<script src="../js/util/mock-ads.html.js"></script>
<script src="../lib/sinon/sinon-1.1.1.js"></script>
<script src="../lib/sinon/sinon-ie-1.1.1.js"></script>
<script>

    FT.ads.initDFP();


    if (typeof(FT._ads.utils.cookies.FTQA) !== "undefined" ) {

        envVars = FT._ads.utils.cookies.FTQA.split("%3B");

        for (j=0;j<envVars.length;j++) {
            if (re.test(envVars[j])) {
                nameAndValue = envVars[j].split("%3D");
                FT.env[nameAndValue[0]] = nameAndValue[1];
                debugStr += nameAndValue[0] + ' = ' + nameAndValue[1] + ' ';
            }
        }

        //now we find what test mode we are in and either call DFP (Integration) or Mock the ad call (unit)
        testMode = unitOrIntegrationMode(FT._ads.utils.cookies.FTQA);

        if (testMode === 'unit')
        {
            //if unit test, then we override FT.lib.writeScript with the call to Mocking
            FT._ads.utils.writeScript = function (URL){
                mockAdContent(URL, Tests); // Ads injected immediately
            };

            var Tests = {
                'intro': TestMockAd.intro,
                'banlb': TestMockAd.banlb3,
                'newssubs': TestMockAd.newssubs2,
                'tlbxrib': TestMockAd.tlbxrib,
                'mktsdata': TestMockAd.mktsdata,
                'hlfmpu': TestMockAd.hlfmpu,
                'doublet': TestMockAd.doublet,
                'refresh': TestMockAd.refresh
            };
        }

    }
</script>

<script src="../js/ft/audienceScienceFacade.js"></script>

<!-- not acceptable as synchronous loading of third party scripts is dangerous-->
<!--<script src="http://js.revsci.net/gateway/gw.js?csid=J07717"></script>-->

<!-- asynschronous loading via jQuery of initial rev sci code-->
<!-- issue wth race condition needs resolving -->
<script src="../js/ft/revenue-science.js"></script>

<script>
    //set up test spies
    FT.test = {};
    FT.test.spyFacadeAddEncToLoc = sinon.spy(FT.analytics.audienceScience, "addEncToLoc");
    FT.test.spyFacadeTag = sinon.spy(FT.analytics.audienceScience, "tag");
    FT.test.spyWindowJ07717DM_addEncToLoc = sinon.spy(window.J07717,"DM_addEncToLoc");
    FT.test.spyWindowJ07717DM_tag = sinon.spy(window.J07717,"DM_tag");

</script>
<script src="../js/ft/audienceScience.js"></script>

</head>

<body>
<script>
    document.write('<p>' + debugStr + '</p>');
</script>
<p>From here down the page's div structure resembles the home page
    structure. Div's to hold the final ad location are just below.</p>
<p>If no ads show, then there is something wrong with the code or
    with the ad targeting.</p>
<div id='father-of-intro'>
    <div id="fullpage-container">Ad request fullpage-container</div>
    <script>
        FT._ads.utils.cookies.FTQA = "ord=123123123";
        FT.ads.request('intro');
    </script>
</div>
<div class="clearfix container">
    clearfix container
    <div class="master-column middleSection" data-zone="middleSection">
        master-column middleSection
        <div class="master-row topAds">
            master-row topAds
            <div id="banlb" class="advertising">
                Ad request banlb
                <script>FT.ads.request("banlb");</script>
            </div>
            <div id="newssubs" class="advertising">
                Ad request newssubs
                <script>FT.ads.requestNewssubs();</script>
            </div>
        </div>
        <div class="master-row railSection" data-zone="railSection">
            master-row railSection
            <div id="tlbxrib" class="advertising">
                Ad request tlbxrib
                <script>FT.ads.request("tlbxrib");</script>
            </div>
            <div class="freestyle">
                freestyle
                <div id="wsodHomePageModule" class="rightRailComponent">
                    Ad request wsodHomePageModule
                    <div id="wsodHomePageModuleContent">
                        Ad request wsodHomePageModuleContent
                        <div class="advertising" id="mktsdata">
                            Ad request mktsdata
                            <script>FT.ads.request("mktsdata");</script>
                        </div>
                    </div>
                </div>
            </div>

            <div id="hlfmpu" class="advertising">
                Ad request hlfmpu
                <script>FT.ads.request("hlfmpu");</script>
            </div>
            <div class="railComponent togglable maximised advertising">
                railComponent togglable maximised advertising <span
                    class="toggleButton"> </span>
                <h3 class="">
                    <span class="railComponentHeading"> Highlights </span>
                </h3>
                <div class="toggleContent">
                    toggleContent
                    <div id="doublet">
                        Ad request doublet
                        <script>FT.ads.request("doublet");</script>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <div class="adRequests">
        adRequests
        <div id="oob">
            Ad request oob
            <script>FT.ads.request('oob');</script>
        </div>
        <div id="corppop">
            Ad request corppop
            <script>FT.ads.request('corppop');</script>
        </div>
        <div id="refresh" class="advertising">
            Ad request refresh
            <script>FT.ads.request('refresh');</script>
        </div>

    </div>
</div>
</body>
</html>

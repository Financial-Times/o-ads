<!DOCTYPE html>
<html>
<head>
  <title>Ads Lib Reporting</title>
  <script>
    var FT = FT || {};
  </script>
  <script src="test-classes/lib/jquery/jquery-1.7.2.js"></script>
  <script src="site/js/bootstrap.min.js"></script>
  <script src="site/js/socket.io.js"></script>
  <script src="test-classes/js/ft/advertising.utils.js"></script>
  <script src="test-classes/js/ft/advertising.utils.cookie.js"></script>
  <script src="test-classes/js/util/mock-ads.html.js"></script>

  <link href="site/css/bootstrap.min.css" rel="stylesheet">
  <!--link href="site/css/bootstrap-responsive.min.css" rel="stylesheet" -->
  <link href="site/css/custom.css" rel="stylesheet">
</head>
<body>
<div class="navbar navbar-inverse navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container-fluid">
<!--       <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button> -->
      <a class="brand" href="./index.html">Ads Lib Reporting</a>
      <ul class="nav">
        <li>
            <a href="coverage/total-report.html" target="content">Coverage Report</a>
        </li>
        <li>
            <a href="site/jsdoc" target="content">JSDocs</a>
        </li>
        <li>
            <a href="test-classes" target="content">QUnit Runners</a>
        </li>
        <li>
            <a href="surefire-reports/html" target="content">QUnit Report</a>
        </li>
        <li id="jshint">
            <a href="site/jshint/jshint.html" target="content">JSHint <span class="badge badge-important"></span></a>
        </li>
        <li class="dropdown">
              <a href="#" id="drop1" class="dropdown-toggle" data-toggle="dropdown">Tools <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li>
                  <a href="site/cookie-tool.html" target="content">Cookie Tool</a>
                </li>
                <li class="divider"></li>
                <li>
                  <a tabindex="-1" href="http://tagshooter.com" target="content">Tagshooter</a>
                </li>
                <li>
                  <a tabindex="-1" href="http://ahp.svc.ft.com/tasks/project/ProjectTasks/viewDashboard?projectId=648" target="_blank">AHP</a>
                </li>
                <li>
                  <a tabindex="-1" href="https://www.google.com/dfp" target="_blank">DFP</a>
                </li>
                <li>
                  <a tabindex="-1" href="http://git.svc.ft.com/summary/modules%2Fadvertising.git" target="content">Git Blit</a>
                </li>
                <li>
                  <a href="http://admintools.internal.ft.com:86/adstools/index.html" target="content">AdsInfoDFP</a></li>
                </li>
              </ul>
        </li>
      </ul>
      <ul class="nav pull-right" id="testMode">
        <li class="dropdown"><a href="#" id="drop2" class="dropdown-toggle" data-toggle="dropdown">Unit <b class="caret"></b></a>
          <ul class="dropdown-menu">
            <li><a tabindex="-1" href="#">unit</a></li>
            <li><a tabindex="-1" href="#">integration</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</div>
  <iframe src="" name="content">
    <h1>hi there</h1>
    <p>please pick an option from the top</p>
  </iframe>
  <ul id="test-results">
    <li class="chrome">
      Chrome <span class="badge badge-success">6</span>
    </li>
    <li class="firefox">
      Firefox <span class="badge badge-success">6</span>
    </li>
    <li class="canary">
      Canary <span class="badge badge-important">6</span>
    </li>
    <li class="safari">
      Safari <span class="badge badge-important">6</span>
    </li>
  </ul>
  <script>
    (function (w, d, $, u) {
      var iframe, iframeDoc;

      function validateDomain() {
        if(location.hostname.match(/ft\.com$/) === null) {
          alert("Warning: Not viewing this site on an ft.com domain will cause some tests to fail!");
        }
      }

      function validateMenuLinks() {
        function each(index, item) {
          $.ajax(item.href).success(function () {
            $(item).parents('li').show();
          });
        }
        $('.nav a').each(each);
      }

      function rememberCurrentLocation(ev) {
        var current = iframe.contentWindow.location.href;
        localStorage.setItem('location', current);
      }

      function reloadLocation() {
        var old = localStorage.getItem('location');
        if(!!old) {
          iframe.src = old;
        }
      }

      function testModeInit() {
        var testMode = unitOrIntegrationMode(FT._ads.utils.cookies.FTQA),
           dropDown = $('#testMode');
           mainLink = $('#drop2');

        function changeTestMode(testMode) {
          mainLink.text(testMode).append('<b class="caret"></b>');
          dropDown.removeClass().addClass('nav pull-right ' + testMode);
          FT._ads.utils.cookie('FTQA', testMode);
        }

        dropDown.on('click', 'ul.dropdown-menu a', function(){
          var testMode = $(this).text().trim();
          changeTestMode(testMode);
          if(!!iframe.contentWindow.location.href.match('test-classes')) {
            iframe.contentWindow.location.reload();
          }
        });
        changeTestMode(testMode);
      }

      function onReady() {
        iframe = d.querySelector('iframe'),
        iFrameDoc = iframe.contentWindow.document;
        w.iframe = iframe;
        validateDomain();
        validateMenuLinks();
        reloadLocation();
        testModeInit();
        $(w).unload(rememberCurrentLocation);
      }

      $(onReady);
    }(window, document, jQuery));
  </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <title>Ads Enabling Team Cookie Tool</title>

  <meta charset="UTF-8">

  <script src="../test-classes/lib/jquery/jquery-1.7.2.js"></script>
  <script src="../test-classes/lib/jquery/jquery-cookie.js"></script>

  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/cookie-tool.css" rel="stylesheet" />
  <script>
    function encode(str) {
      return encodeURIComponent(str);
    }

    function decode(str) {
      return decodeURIComponent(str);
    }

    hashes = {
        cookies: function() {
          var hash = {};
          document.cookie.split('; ').forEach(
          function(item){
              item  = item.split('=');
              hash[item[0]] = item[1];
            }
          );
          return hash;
        }(),
        hash: function () {
          var hash = {};
          location.hash.slice(1).split('&').forEach(
          function(item){
              item  = item.split('=');
              hash[decode(item[0])] = decode(item[1]);
            }
          );
          return hash;
        }()
      };

  $(function(){
    var header = $('h1'),
      cookiesSec = $('#cookies'),
      examplesSec = $('#exmaples'),
      prepopulaters = $('#prepopulaters'),
      form = $('form[name="cookie-setter"]'),
            defaultLocation = document.location.protocol + '//' + document.location.host + document.location.pathname,
      defaultCookieOptions = { expires: 7, path: '/', domain: '.ft.com', secure: false };


    function renderMessage(msg, type) {
      type = type ? ' ' + type : '';
      $('.alert-message').remove();
      $('<p class="alert-message' + type + '"></p>').append(msg).insertAfter(header);
      return true;
    }

    form.submit(function() {
      var defaults = { expires: 'Expires', path: '', domain: 'Domain' },
        values = $.extend({}, defaultCookieOptions);

      $('input, select').each(function (index, item) {
        var key = item.name,
          value = $(item).val();

        if(defaults[key] !== value) {
          values[key] = $(item).val();
        }
      });

      if (!values.name) {
        renderMessage('cookie not set: no name supplied', 'error');
        return false;
      }

      $.cookie(values.name, values.value, values);
      document.location.hash = '#action=set&name=' + encode(values.name) + '&value=' + decode(values.value);
      document.location.reload();
      return false;
    });

    form.find('select[name="domain"]')
      .append('<option>' + document.location.hostname + '</option>');

    $('#cookies').on('click', '.delete', function(ev){
      var row = $(this).parents('tr'),
        name = $(this).parent().next().text().trim();

      $('[name="domain"] option').each(function(index,item){
        if (index !== 0) {
          $.removeCookie(name, {path: '/', domain: $(item).val()});
        }
      });
      $.removeCookie(name, {path: '/'});
      row.remove();
    });

    prepopulaters.on('click', 'button', function(ev){
        var name, value, values, cookie,
          i = 0,
          cookies =  $(this).data('cookies');
        for(;i < cookies.length; i++) {
            cookie = cookies[i];
            $.cookie(cookie.name, cookie.value, defaultCookieOptions);
        }
        if(cookies.length === 1) {
          document.location.hash = '#action=set&name=' + encode(cookies[0].name) + '&value=' + encode(cookies[0].value);
        } else {
          document.location.hash = '#action=multiset&cookies=' + encode(JSON.stringify(cookies));
        }
        document.location.reload();
    });

    cookiesSec.on('click', '.delete', function(ev){
      var row = $(this).parents('tr'),
        name = $(this).data('cookie-name');

      $('[name="domain"] option').each(function(index,item){
        if (index !== 0) {
          $.removeCookie(name, {path: '/', domain: $(item).val()});
        }
      });
      $.removeCookie(name, {path: '/'});
      row.remove();
      document.location.hash = '#action=remove&name=' + encode(name);
      document.location.reload();
    });

    function handleEvents(){
      var hash = hashes.hash,
        cookies = hashes.cookies,
        actions = {
        set: function () {
          if(hash.name in cookies) {
            renderMessage('cookie set: name ' + hash.name + ' value ' + hash.value, 'success');
          } else {
            renderMessage('sorry, failed to set cookie: name ' + hash.name, 'error');
          }
        },
        multiset: function() {
          var cookie,
            msg = '<ul>',
            setCookies = JSON.parse(hash.cookies),
            passed = 0,
            failed = 0;
          while(cookie = setCookies.pop()) {
            if(cookie.name in cookies) {
              passed++;
              msg += '<li class="success">name ' + cookie.name + ' value ' + cookie.value + '</li>';
            } else {
              failed++;
              msg += '<li class="error">name ' + cookie.name + ' value ' + cookie.value + '</li>';
            }
          }
          msg += '</ul>';

          msg = passed + ' cookies set ' + failed + ' cookies failed!' + msg;
          renderMessage(msg);
        },
        remove: function () {
          if(!(hash.name in cookies)) {
            renderMessage('cookie removed: name ' + hash.name, 'success');
          } else {
            renderMessage('sorry, failed to remove cookie: name ' + hash.name, 'error');
          }
        },
        default: function (){
          renderMessage('ya\'ll dont be fiddlin wit ma cookie tool!!');
        }
      }

      if(hash.action in actions){
        actions[hash.action]();
      } else if (hash.action){
        actions['default']();
      }
      document.location.hash = '';
    }

    handleEvents(hashes.hash);

    if(document.cookie === '') {
      cookiesSec.find('table').remove();
      cookiesSec.append('<p class="alert-message">No cookies set.</p>');
    } else {
      var name, value,
        table = cookiesSec.find('table tbody');

      for(name in hashes.cookies){
        value = hashes.cookies[name];
        table.append('<tr><td><span class="delete" data-cookie-name="' + name + '">&times;</span><td>' + decode(name) +'</td><td>'+ decode(value) + '</td></tr>');
      }
    }
  });
  </script>
</head>
<body>
<h1>Ads Enabling Team Cookie Tool</h1>
<section>
  <h2>Set Cookie</h2>
  <form name="cookie-setter" class="form-inline">
    <fieldset>
      <input type="text" name="name" class="input-small" placeholder="Name" value="FTQA">
      <input type="text" name="value" placeholder="Value">
      <button type="submit" class="btn btn-primary">Set</button>
      <span class="help-block">Example: name <code>FTQA</code> value <code>debug,timeout=2000,interval=100</code></span>
    </fieldset>
    <fieldset>
      <input type="text" name="path" class="input-small" placeholder="Path">

      <select name="domain" class="input-small">
        <option>Domain</option>
        <option>.ft.com</option>
        <option>www.ft.com</option>
      </select>

      <select name="expires" class="input-small">
        <option>Expires</option>
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
        <option>6</option>
        <option>7</option>
        <option>365</option>
      </select>
      <span class="help-block">Path will default to <code>/</code> Expires will default to <code>7</code> Domain will default to <code>.ft.com</code></span>
    </fieldset>
  </form>
  <section id="prepopulaters">
    <div id="testing-prepopulaters" class="btn-group">
        <h3>Predefined cookie values for Testing</h3>
        <button class="btn btn-success" data-cookies='[{"name": "FTQA", "value" : "env=nolive"}]'>Show test ads</button>​
        <button class="btn btn-success" data-cookies='[{"name": "FTQA", "value" : "env=live"}]'>​Show live ads</button>​
    </div>

    <div id="dev-prepopulaters" class="btn-group">
        <h3>Predefined cookie values for Developers</h3>
        <button class="btn btn-success" data-cookies='[{"name": "FTQA", "value" : "integration"}]'>Integration mode</button>​
        <button class="btn btn-success" data-cookies='[{"name": "FTQA", "value" : "unit"}]'>Unit mode</button>​
    </div>

    <div id="ipad-prepopulaters" class="btn-group">
        <h3>Predefined cookie values for webapp</h3>
        <button class="btn btn-info" data-cookies='[{"name": "FTQA", "value" : "debug,env=test,screenmode=large,eid=rockabox-eval,ord=123123"}]'>FTQA for Rockabox​</button>​
        <button class="btn btn-info" data-cookies='[{"name": "FTQA", "value" : "debug,env=test,screenmode=large,eid=medialets-eval,ord=123123"}]'>​FTQA for Medialets​</button>​
        <button class="btn btn-info" data-cookies='[{"name": "FTQA", "value" : "debug,ghostbug=1,env=test,ghost=1,zone=fullpage-test,eid=fullpage-ipad,screenmode=large"}]'>FTQA for fullscreen iPad​</button>​
        <button class="btn btn-info" data-cookies='[{"name": "FTQA", "value" : "debug,ghostbug=1,env=test,ghost=1,zone=fullpage-test,eid=fp-perf-1.6mb,screenmode=large"}]'>​FTQA for slow fullscreen​</button>​
    </div>
  </section>
</section>
<hr>
<section id="cookies">
  <h2>All Cookies</h2>
  <span class="help-block">Only cookies with a path of <code>/</code> can be deleted from here.</span>
  <table>
    <thead>
      <th colspan="2">Name</th>
      <th>Value</th>
    </thead>
    <tbody>
    </tbody>
  </table>
</section>

<hr>
<section id="examples">
  <h2>Examples</h2>
   <table border="1">
       <thead>
         <tr><th>Where *</th><th>Key/Value</th><th>Purpose</th></tr>
       </thead>
       <tbody>
         <tr><td>WA/FT</td><td>debug</td><td>turn on debugging messages in the console log for ads.</td></tr>
         <tr><td>WA</td><td>ghostbug=0 or 1</td><td>display ghostwriter specific debugging messages.</td></tr>
         <tr><td>WA</td><td>remotedebug=host:port</td><td>specify a host/port for remote debugging on device with <a href="http://people.apache.org/~pmuellr/weinre/docs/latest/">Weinre</a>.</td></tr>
         <tr><td>FT</td><td>breakout=banlb</td><td>cause a javascript breakpoint when the banlb ad position returns (only for custom template ads)</td></tr>
         <tr><td>WA</td><td>break=setup,adcall,etc</td><td>cause a breakpoint in the adCall method of the ad library.</td></tr>
         <tr><td>WA/FT</td><td>env=live or nolive (or test for WA)</td><td>simulate live or non-live environment to show ads from Live or Test</td></tr>
         <tr><td>FT</td><td>env=premiumcopy</td><td>Creates DFP urls to access DFP Premium Copy Network. Note that this will work with a 'live' or 'nolive' prefix</td></tr>
         <tr><td>FT</td><td>env=premiumreadonly</td><td>Creates DFP urls to access DFP Premium Read Only Network. Note that this will work with a 'live' or 'nolive' prefix</td></tr>
         <tr><td>WA</td><td>site=sitename</td><td>override the DFP site used in ad calls.</td></tr>
         <tr><td>WA</td><td>zone=zonename</td><td>override the DFP zone used in ad calls.</td></tr>
         <tr><td>WA</td><td>platform=ios or an, pb, bb, wm</td><td>override the device platform.</td></tr>
         <tr><td>WA</td><td>screenmode=largewide or large, medium, small</td><td>override the device screen mode.</td></tr>
         <tr><td>WA</td><td>fullpage= 0=off, L=landscape P=portrait</td><td>force full page ad mode.</td></tr>
         <tr><td>WA</td><td>eid=7234</td><td>override the user erights ID in the ad calls.</td></tr>
         <tr><td>WA</td><td>slow=0 to 1</td><td>override the slow connection parameter in ad calls.</td></tr>
         <tr><td>WA</td><td>ghost=0 or 1</td><td>override the use of ghostwriter in the ad library.</td></tr>
         <tr><td>WA</td><td>timings=0 or 1</td><td>display timing information on the ads.</td></tr>
         <tr><td>FT</td><td>longest_url=0-0 (never) 10-100 (10% chance) or 100-100 (always)</td><td>set the % ratio for reporting unclassified pages and long ad call URL's to track.ft.com</td></tr>
         <tr><td>FT</td><td>timeout=100</td><td>milliseconds timeout to collapse ad position if ad call fails to return</td></tr>
         <tr><td>FT</td><td>interval=300</td><td>millisecond period to check ad positions to see if an ad has come back and needs to be made visible</td></tr>
         <tr><td>WA/FT</td><td>ord=123123123</td><td>set a specific ord value for ad calls. useful when intercepting ad calls with a web proxy</td></tr>
         <tr><td>WA/FT</td><td>noaudsci</td><td>omit Audience Science values from ad call. useful when intercepting ad calls with a web proxy</td></tr>
         <tr><td>FT</td><td>setxy=150,120</td><td>Change XY position of diagnostics dialog box</td></tr>
       </tbody>
   </table>
</section>
</body>
</html>

<script data-o-ads-config type="application/json">
	{
		"gpt": {
			"network": {{network}},
			"site": "{{site}}",
			"zone": "{{zone}}"
		},
		"lazyLoad": {
			"viewportMargin": "{{viewportMargin}}"
		}
	}
</script>
<script>
	const moreObserverCallback = (entries, observer) => {
		entries.forEach((entry) => {
			const slotName = entry.target.getAttribute('id')
			
			if (entry.isIntersecting) {
				const adSlot = moreContent()
				const slotName = adSlot.getAttribute('data-o-ads-name')
				console.debug(`moreObserverCallback(): Initialized ad slot ${slotName}`)
			}
		})
	}

	const moreObserver = new IntersectionObserver(
		moreObserverCallback,
		{ root: null, rootMargin: '0px', threshold: 0.1 }
	)
</script>
<script>
	let count = 0

	const initSlot = (oAds) => {
		console.debug('initSlot()')
		return oAds.slots.initSlot.bind(oAds.slots)
	}

	// Create and add fake content
	const addFakeContent = (text) => (parent) => {
		console.debug(`addFakeContent(): text ${text}`)
		const h2 = document.createElement("h2")
		const textNode = document.createTextNode(text)
		h2.appendChild(textNode)
		parent.appendChild(h2)
	}

	// Create and add an Ad Slot
	const createAdSlotContainer = (formats) => {
		console.debug(`createAdSlotContainer(): formats ${formats}`)
		const adSlot = document.createElement('div')
		adSlot.setAttribute('data-o-ads-formats', formats)
		return adSlot
	}

	const addAdSlot = (formats) => (parentDoc) => {
		console.debug(`addAdSlot(): formats ${formats}`)
		const adSlot = createAdSlotContainer(formats)
		parentDoc.appendChild(adSlot)
		initSlot(oAds)(adSlot)
		return adSlot
	}

	const moreContent = () => {
		console.debug(`moreContent()`)
		const parentNode = document.querySelector(`div[id=contentArea]`)

		// Add some dynamic fake content
		addFakeContent(`Dynamic Fake Content #${count++}`)(parentNode)

		// Create and add the Ad Slot itself
		return addAdSlot('{{formats}}')(parentNode)
	}
</script>

<body style='height: 100%'>
	<div id='contentArea' style='height: 100%'></div>

	<!-- Button to load more content dynamically. -->
	<button onclick="moreContent()">More Content</button>

	<div id='more'>...more content</div>
</body>

<script>
	moreObserver.observe(document.getElementById('more'))
</script>
